<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tron dApp</title>
  <!-- ðŸ”‘ CRITICAL: Load tronweb CDN to signal "this is a Tron dApp" -->
  <script src="https://cdn.jsdelivr.net/npm/tronweb@5.3.0/dist/TronWeb.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    .btn { padding: 12px 24px; background: #3375BB; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; }
    #status { margin-top: 20px; padding: 10px; background: #eef7ff; border-radius: 6px; display: none; }
  </style>
</head>
<body>
  <h2>Connect Tron Wallet</h2>
  <button id="connectBtn" class="btn">Connect</button>
  <div id="status"></div>

  <script>
    const btn = document.getElementById('connectBtn');
    const status = document.getElementById('status');

    function show(msg, success = true) {
      status.textContent = msg;
      status.style.display = 'block';
      status.style.backgroundColor = success ? '#eef7ff' : '#ffeaea';
    }

    // Check if inside Trust Wallet
    if (typeof window.tronWeb !== 'undefined') {
      // Already in wallet â†’ trigger prompt
      btn.textContent = "Get Address";
      btn.onclick = () => {
        try {
          // âš ï¸ This triggers the permission dialog
          const addr = window.tronWeb.defaultAddress.base58;
          show(`âœ… ${addr}`);
        } catch (e) {
          show("âŒ Rejected", false);
        }
      };

      // Auto-trigger after short delay
      setTimeout(() => {
        if (!window.tronWeb.defaultAddress?.base58) {
          btn.click();
        }
      }, 600);
    } else {
      // External browser â†’ redirect
      btn.textContent = "Open in Trust Wallet";
      btn.onclick = () => {
        const url = encodeURIComponent(window.location.origin + window.location.pathname);
        window.open(`https://link.trustwallet.com/open_url?coin_id=195&url=${url}`, '_blank');
      };
    }
  </script>
</body>
</html>
